<!-- src/app/test-plan-viewer/test-plan-viewer.component.html -->
<div class="viewer-container">
  <!-- VISTA DE LISTA -->
  <div *ngIf="!selectedTestPlan" class="list-view">

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <div class="spinner"></div>
      <p>Cargando planes de prueba...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="!isLoading && errorMessage" class="error-state">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="error-icon">
        <path fill-rule="evenodd"
          d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z"
          clip-rule="evenodd" />
      </svg>
      <h3>Error al cargar</h3>
      <p>{{ errorMessage }}</p>
      <button class="button-retry" (click)="loadTestPlans()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd"
            d="M15.312 11.424a5.5 5.5 0 01-9.201 2.466l-.312-.311h2.433a.75.75 0 000-1.5H3.989a.75.75 0 00-.75.75v4.242a.75.75 0 001.5 0v-2.43l.31.31a7 7 0 0011.712-3.138.75.75 0 00-1.449-.39zm1.23-3.723a.75.75 0 00.219-.53V2.929a.75.75 0 00-1.5 0V5.36l-.31-.31A7 7 0 003.239 8.188a.75.75 0 101.448.389A5.5 5.5 0 0113.89 6.11l.311.31h-2.432a.75.75 0 000 1.5h4.243a.75.75 0 00.53-.219z"
            clip-rule="evenodd" />
        </svg>
        Reintentar
      </button>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && !errorMessage && testPlans.length === 0" class="empty-state">
      <div class="empty-icon-wrapper">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
          class="empty-icon">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
      </div>
      <h3>No hay planes de prueba</h3>
      <p>Comienza creando tu primer test plan</p>
      <button class="button-create" [routerLink]="['/generator']">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
          <path
            d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
        </svg>
        Crear Test Plan
      </button>
    </div>

    <!-- Barra de búsqueda y filtros -->
    <div *ngIf="!isLoading && !errorMessage && testPlans.length > 0" class="filters-bar">
      <div class="search-container">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="search-icon">
          <path fill-rule="evenodd"
            d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z"
            clip-rule="evenodd" />
        </svg>
        <input type="text" class="search-input" placeholder="Buscar por nombre o HU..." [(ngModel)]="searchQuery"
          (input)="onSearchChange()">
        <button *ngIf="searchQuery" class="clear-search" (click)="searchQuery = ''; onSearchChange()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path
              d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
          </svg>
        </button>
      </div>

      <div class="filter-group">
        <label class="filter-label">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd"
              d="M2.628 1.601C5.028 1.206 7.49 1 10 1s4.973.206 7.372.601a.75.75 0 01.628.74v2.288a2.25 2.25 0 01-.659 1.59l-4.682 4.683a2.25 2.25 0 00-.659 1.59v3.037c0 .684-.31 1.33-.844 1.757l-1.937 1.55A.75.75 0 018 18.25v-5.757a2.25 2.25 0 00-.659-1.591L2.659 6.22A2.25 2.25 0 012 4.629V2.34a.75.75 0 01.628-.74z"
              clip-rule="evenodd" />
          </svg>
          Sprint
        </label>
        <select class="filter-select" [(ngModel)]="selectedSprintFilter" (change)="onSprintFilterChange()">
          <option value="all">Todos los Sprints</option>
          <option *ngFor="let sprint of getAvailableSprints()" [value]="sprint">{{ sprint }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path
              d="M10 9a3 3 0 100-6 3 3 0 000 6zM6 8a2 2 0 11-4 0 2 2 0 014 0zM1.49 15.326a.78.78 0 01-.358-.442 3 3 0 014.308-3.516 6.484 6.484 0 00-1.905 3.959c-.023.222-.014.442.025.654a4.97 4.97 0 01-2.07-.655zm16.48 0a.77.77 0 00.357-.442 3 3 0 00-4.308-3.517 6.484 6.484 0 011.907 3.96 2.32 2.32 0 01-.026.654 4.97 4.97 0 002.07-.655z" />
          </svg>
          Célula
        </label>
        <select class="filter-select" [(ngModel)]="selectedCellFilter" (change)="onCellFilterChange()">
          <option value="all">Todas las Células</option>
          <option *ngFor="let cell of getAvailableCells()" [value]="cell">{{ cell }}</option>
        </select>
      </div>

      <div class="results-count">
        <span class="count-badge">{{ filteredTestPlans.length }}</span>
        <span class="count-text">{{ filteredTestPlans.length === 1 ? 'resultado' : 'resultados' }}</span>
      </div>
    </div>

    <!-- Test Plans Grid Agrupados -->
    <div *ngIf="!isLoading && !errorMessage && paginatedTestPlans.length > 0" class="test-plans-content">
      <div *ngFor="let group of getGroupedTestPlans(); let isFirst = first" class="sprint-group"
        [class.active-sprint]="isFirst">
        <div class="sprint-timeline-line"></div>
        <div class="sprint-header">
          <div class="sprint-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" *ngIf="isFirst">
              <path fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-11.25a.75.75 0 00-1.5 0v2.5h-2.5a.75.75 0 000 1.5h3.25a.75.75 0 00.75-.75v-3.25z"
                clip-rule="evenodd" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" *ngIf="!isFirst">
              <path fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z"
                clip-rule="evenodd" />
            </svg>
            Sprint {{ group.sprint }}
          </div>
          <span class="sprint-badge" [class.badge-blue]="isFirst" [class.badge-gray]="!isFirst">
            {{ group.plans.length }} {{ group.plans.length === 1 ? 'plan' : 'planes' }}
          </span>
        </div>

        <div class="plans-grid">
          <div *ngFor="let testPlan of group.plans" class="plan-card" (click)="selectTestPlan(testPlan)">
            <!-- Card Content -->
            <div class="card-content">
              <!-- Título -->
              <h3 class="card-title" [title]="testPlan.title">{{ testPlan.title }}</h3>

              <!-- Fecha compacta -->
              <div class="card-date">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd"
                    d="M5.75 2a.75.75 0 01.75.75V4h7V2.75a.75.75 0 011.5 0V4h.25A2.75 2.75 0 0118 6.75v8.5A2.75 2.75 0 0115.25 18H4.75A2.75 2.75 0 012 15.25v-8.5A2.75 2.75 0 014.75 4H5V2.75A.75.75 0 015.75 2zm-1 5.5c-.69 0-1.25.56-1.25 1.25v6.5c0 .69.56 1.25 1.25 1.25h10.5c.69 0 1.25-.56 1.25-1.25v-6.5c0-.69-.56-1.25-1.25-1.25H4.75z"
                    clip-rule="evenodd" />
                </svg>
                {{ formatDate(testPlan.created_at) }}
              </div>

              <!-- Métricas como chips -->
              <div class="card-metrics">
                <div class="metric-chip metric-chip-hu">
                  <span>{{ testPlan.user_stories?.length || 0 }} HUs</span>
                </div>
                <div class="metric-chip metric-chip-cases">
                  <span>{{ getTestCaseCount(testPlan) }} Casos</span>
                </div>
                <div class="metric-chip metric-chip-steps">
                  <span>{{ getTotalStepsCount(testPlan) }} Pasos</span>
                </div>
              </div>

              <!-- Acciones compactas -->
              <div class="card-actions">
                <button class="action-button action-view" (click)="selectTestPlan(testPlan); $event.stopPropagation()">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z" />
                    <path fill-rule="evenodd"
                      d="M.664 10.59a1.651 1.651 0 010-1.186A10.004 10.004 0 0110 3c4.257 0 7.893 2.66 9.336 6.41.147.381.146.804 0 1.186A10.004 10.004 0 0110 17c-4.257 0-7.893-2.66-9.336-6.41zM14 10a4 4 0 11-8 0 4 4 0 018 0z"
                      clip-rule="evenodd" />
                  </svg>
                  Ver detalles
                </button>
                <button class="action-button action-delete" (click)="deleteTestPlan(testPlan); $event.stopPropagation()"
                  title="Eliminar">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                      d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z"
                      clip-rule="evenodd" />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sin resultados de búsqueda -->
    <div *ngIf="!isLoading && !errorMessage && testPlans.length > 0 && filteredTestPlans.length === 0"
      class="no-results">
      <div class="no-results-icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      </div>
      <h3>No se encontraron resultados</h3>
      <p>Intenta con otros términos de búsqueda o filtros</p>
      <button class="button-secondary"
        (click)="searchQuery = ''; selectedSprintFilter = 'all'; selectedCellFilter = 'all'; applyFilters()">
        Limpiar filtros
      </button>
    </div>

    <!-- PAGINADOR -->
    <div *ngIf="!isLoading && !errorMessage && filteredTestPlans.length > 0" class="pagination-container">
      <div class="pagination-info">
        <p>
          Mostrando <strong>{{ (currentPage - 1) * itemsPerPage + 1 }}</strong> -
          <strong>{{ Math.min(currentPage * itemsPerPage, filteredTestPlans.length) }}</strong>
          de <strong>{{ filteredTestPlans.length }}</strong> {{ filteredTestPlans.length === 1 ? 'plan' : 'planes' }}
        </p>
      </div>

      <div class="pagination-controls" *ngIf="totalPages > 1">
        <!-- Botón Anterior -->
        <button class="pagination-button pagination-prev" [disabled]="currentPage === 1" (click)="previousPage()"
          title="Página anterior">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd"
              d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z"
              clip-rule="evenodd" />
          </svg>
        </button>

        <!-- Números de página -->
        <div class="pagination-numbers">
          <button *ngFor="let page of getPageNumbers()" [class.pagination-number]="page > 0"
            [class.pagination-ellipsis]="page === -1" [class.active]="page === currentPage"
            [disabled]="page === -1 || page === currentPage" (click)="page > 0 ? goToPage(page) : null">
            {{ page === -1 ? '...' : page }}
          </button>
        </div>

        <!-- Botón Siguiente -->
        <button class="pagination-button pagination-next" [disabled]="currentPage === totalPages" (click)="nextPage()"
          title="Página siguiente">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd"
              d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z"
              clip-rule="evenodd" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- VISTA DETALLADA / EDICIÓN -->
  <div *ngIf="selectedTestPlan" class="detail-view">
    <!-- Cabecera mejorada estilo Apple/Linear/Notion -->
    <div class="detail-header">
      <div class="header-container">
        <!-- Breadcrumb Navigation -->
        <div class="breadcrumb-nav">
          <button class="breadcrumb-button" (click)="backToList()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd"
                d="M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z"
                clip-rule="evenodd" />
            </svg>
            <span>Lista de Planes</span>
          </button>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-current">Detalle del Plan</span>
        </div>

        <!-- Título principal con descripción -->
        <div class="header-title-section">
          <h1 class="header-title">{{ testPlanTitle }}</h1>
          <p class="header-subtitle">
            {{ huList.length }} {{ huList.length === 1 ? 'Historia de Usuario' : 'Historias de Usuario' }} ·
            {{ getTestCaseCount(selectedTestPlan) }} Casos de Prueba ·
            {{ getTotalStepsCount(selectedTestPlan) }} Pasos
          </p>
        </div>

        <!-- Botones de acción agrupados -->
        <div class="header-actions">
          <button class="button-secondary-action" (click)="openPreview()" [disabled]="huList.length === 0">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path d="M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z" />
              <path fill-rule="evenodd"
                d="M.664 10.59a1.651 1.651 0 010-1.186A10.004 10.004 0 0110 3c4.257 0 7.893 2.66 9.336 6.41.147.381.146.804 0 1.186A10.004 10.004 0 0110 17c-4.257 0-7.893-2.66-9.336-6.41zM14 10a4 4 0 11-8 0 4 4 0 018 0z"
                clip-rule="evenodd" />
            </svg>
            Previsualizar
          </button>
          <button class="button-primary-action" (click)="saveToDatabase()" [disabled]="savingToDatabase">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z"
                clip-rule="evenodd" />
            </svg>
            <span *ngIf="!savingToDatabase">Guardar Cambios</span>
            <span *ngIf="savingToDatabase">Guardando...</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Contenido del Test Plan -->
    <div class="detail-content">

      <!-- SECCIÓN 1: HISTORIAS DE USUARIO Y CASOS DE PRUEBA -->
      <section class="results-section" *ngIf="huList.length > 0">
        <div class="section-header">
          <h2>
            Historias de Usuario y Casos de Prueba
          </h2>
        </div>

        <div class="hu-list-container">
          <div *ngFor="let hu of huList; trackBy: trackHuById" class="hu-card">
            <div class="hu-header" (click)="toggleHUExpansion(hu)" [class.expanded]="hu.isExpanded">
              <div class="hu-title-section">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="chevron-icon"
                  [class.rotate-90]="hu.isExpanded">
                  <path fill-rule="evenodd"
                    d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z"
                    clip-rule="evenodd" />
                </svg>
                <h3>{{ hu.id }}: {{ hu.title }}</h3>
              </div>
              <div class="hu-meta">
                <span class="sprint-badge">Sprint: {{ hu.sprint }}</span>
                <span *ngIf="hu.originalInput.selectedTechnique" class="mode-indicator"
                  [title]="'Técnica: ' + hu.originalInput.selectedTechnique">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="mode-icon">
                    <path fill-rule="evenodd"
                      d="M15.988 3.012A2.25 2.25 0 0013.75 2H6.25a2.25 2.25 0 00-2.238 2.012L4 16.25A2.25 2.25 0 006.25 18h7.5A2.25 2.25 0 0016 15.75l.012-12.738zM6 4.25a.75.75 0 01.75-.75h6.5a.75.75 0 010 1.5h-6.5a.75.75 0 01-.75-.75zm-.75 3.5a.75.75 0 000 1.5h7.5a.75.75 0 000-1.5h-7.5z"
                      clip-rule="evenodd" />
                  </svg>
                  {{ hu.originalInput.selectedTechnique }}
                </span>
              </div>
            </div>

            <!-- Contenido de la HU (Colapsable) -->
            <div class="hu-content" *ngIf="hu.isExpanded">
              <!-- Alcance (si existe) -->
              <div class="plan-section-block" *ngIf="hu.generatedScope && hu.generatedScope.trim()">
                <h4 class="section-subtitle">Alcance Generado</h4>
                <div class="plan-section-content">
                  <div class="generated-text">{{ hu.generatedScope }}</div>
                </div>
              </div>

              <!-- Lista de Casos de Prueba Colapsables -->
              <!-- Lista de Casos de Prueba (Tabla) -->
              <div class="test-cases-section" *ngIf="hu.detailedTestCases && hu.detailedTestCases.length > 0">
                <h4 class="section-subtitle">
                  Casos de Prueba ({{ hu.detailedTestCases.length }})
                </h4>

                <!-- TABLA DE VISTA PREVIA -->
                <div class="detailed-test-cases-table-container">
                  <table class="detailed-test-cases-table">
                    <thead>
                      <tr>
                        <th>ID Caso</th>
                        <th>Escenario de Prueba (Título)</th>
                        <th>Precondiciones</th>
                        <th>Paso a Paso</th>
                        <th>Resultado Esperado</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let tc of hu.detailedTestCases; let i = index">
                        <td>{{ hu.id }}_CP{{ i + 1 }}</td>
                        <td>{{ tc.title }}</td>
                        <td>
                          <pre class="table-pre">{{ tc.preconditions }}</pre>
                        </td>
                        <td>
                          <ul style="margin: 0; padding-left: 20px; list-style: decimal;">
                            <li *ngFor="let step of tc.steps">{{ step.accion }}</li>
                          </ul>
                        </td>
                        <td>
                          <pre class="table-pre">{{ tc.expectedResults }}</pre>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Botones de Acción -->
                <div class="actions">
                  <button (click)="toggleEdit(hu, 'testCases')" class="button-edit">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                      style="width: 1em; height: 1em; margin-right: 6px;">
                      <path
                        d="M2.695 14.763l-1.262 3.154a.5.5 0 00.65.65l3.155-1.262a4 4 0 001.343-.885L17.5 5.5a2.121 2.121 0 00-3-3L3.58 13.42a4 4 0 00-.885 1.343z" />
                    </svg>
                    Editar / Refinar con IA
                  </button>
                  <button (click)="exportExecutionMatrix(hu)" class="button-secondary">
                    Exportar Matriz (.csv)
                  </button>
                  <button (click)="exportExecutionMatrixToExcel(hu)" class="button-secondary">
                    Exportar Matriz (.xlsx)
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- SECCIÓN 2: CONFIGURACIÓN DEL PLAN (Secciones Generales) -->
      <!-- SECCIÓN 2: CONFIGURACIÓN DEL PLAN (Secciones Generales) -->
      <app-general-sections *ngIf="huList.length > 0" [repositoryLink]="repositoryLink"
        [outOfScopeContent]="outOfScopeContent" [strategyContent]="strategyContent"
        [limitationsContent]="limitationsContent" [assumptionsContent]="assumptionsContent" [teamContent]="teamContent"
        [loadingRepositoryLinkAI]="loadingRepositoryLinkAI" [loadingOutOfScopeAI]="loadingOutOfScopeAI"
        [loadingStrategyAI]="loadingStrategyAI" [loadingLimitationsAI]="loadingLimitationsAI"
        [loadingAssumptionsAI]="loadingAssumptionsAI" [loadingTeamAI]="loadingTeamAI"
        [errorRepositoryLinkAI]="errorRepositoryLinkAI" [errorOutOfScopeAI]="errorOutOfScopeAI"
        [errorStrategyAI]="errorStrategyAI" [errorLimitationsAI]="errorLimitationsAI"
        [errorAssumptionsAI]="errorAssumptionsAI" [errorTeamAI]="errorTeamAI"
        (contentChange)="handleSectionChange($event)" (regenerateAI)="regenerateStaticSectionWithAI($event)">
      </app-general-sections>
    </div>

    <!-- Componente oculto para exportar matriz -->
    <app-excel-matrix-exporter #matrixExporter></app-excel-matrix-exporter>
  </div>
</div>

<!-- Modal de Confirmación de Eliminación -->
<app-confirmation-modal [isOpen]="isDeleteModalOpen" title="Eliminar Test Plan" [message]="deleteModalMessage"
  confirmText="Eliminar" cancelText="Cancelar" type="danger" (confirm)="onConfirmDelete()"
  (cancel)="isDeleteModalOpen = false">
</app-confirmation-modal>
```