<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Matriz de Casos de Prueba</title>
  <style>
    body { font-family: 'Segoe UI', Calibri, Arial, sans-serif; margin: 20px; background-color: #f4f7f9; color: #333; }
    .container { max-width: 1200px; margin: auto; background: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .export-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #dee2e6; }
    .export-bar h1 { margin: 0; font-size: 1.8em; color: #3b5a6b; }
    .btn { padding: 10px 18px; border: none; border-radius: 5px; cursor: pointer; font-size: 0.95em; font-weight: 600; transition: background-color 0.2s ease, transform 0.1s ease; }
    .btn-primary { background-color: #007bff; color: white; }
    .btn-primary:hover { background-color: #0056b3; }
    .btn-secondary { background-color: #6c757d; color: white; }
    .btn-secondary:hover { background-color: #5a6268; }
    .btn-danger { background-color: #dc3545; color: white; }
    .btn-danger:hover { background-color: #c82333; }
    .escenarios-tabs-bar { display: flex; border-bottom: 2px solid #dee2e6; margin-bottom: 20px; }
    .tab { padding: 10px 20px; cursor: pointer; background-color: #f8f9fa; border: 1px solid #dee2e6; border-bottom: none; margin-right: 5px; border-radius: 5px 5px 0 0; }
    .tab.active { background-color: #007bff; color: white; border-color: #007bff; }
    .escenario-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    .escenario-table th, .escenario-table td { border: 1px solid #cbd5e1; padding: 12px; }
    .escenario-table th { background-color: #e3eafc; text-align: left; font-weight: bold; }
    .escenario-table tr:nth-child(even) { background-color: #f8fafc; }
    .escenario-table td[contenteditable="true"] { background-color: #fff; }
    .escenario-table td[contenteditable="true"]:focus { outline: 2px solid #007bff; background-color: #eef4ff; }
    .evidencias-section { margin-top: 25px; border-top: 1px solid #dee2e6; padding-top: 20px; }
    .evidencias-section h3 { margin-top: 0; }
    .evidencias-actions button { margin-right: 10px; }
    .evidencias-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; margin-top: 20px; }
    .evidencia-block { background: #f8fafc; border: 1px solid #cbd5e1; border-radius: 5px; padding: 10px; text-align: center; }
    .evidencia-block img { max-width: 100%; height: auto; border-radius: 4px; margin-bottom: 10px; }
    .evidencia-block input[type='text'] { width: calc(100% - 20px); padding: 5px; border: 1px solid #cbd5e1; border-radius: 3px; margin-bottom: 10px; }
    .evidencia-block .delete-evidencia { float: right; cursor: pointer; color: #dc3545; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <div class="export-bar">
      <h1>Matriz de Casos de Prueba</h1>
      <div>
        <button class="btn btn-secondary" onclick="exportToHtml()">Descargar HTML</button>
        <button class="btn btn-primary" onclick="downloadPDF()">Descargar PDF</button>
      </div>
    </div>

    <div class="escenarios-tabs-bar">
      <div *ngFor="let escenario of escenarios; let i = index" 
           class="tab" 
           [class.active]="i === escenarioActivo" 
           (click)="seleccionarEscenario(i)">
        Caso #{{i + 1}}
      </div>
      <div class="tab" (click)="agregarEscenario()">+ Agregar Escenario</div>
    </div>

    <div *ngIf="escenarios.length > 0 && escenarioActivo !== null">
      <div class="escenario-content">
        <table class="escenario-table">
          <tbody>
            <tr><th>ID Caso</th><td contenteditable="true" (input)="actualizarCampo(escenarioActivo, 'id', $event)">{{ escenarios[escenarioActivo].id }}</td></tr>
            <tr><th>Escenario de Prueba</th><td contenteditable="true" (input)="actualizarCampo(escenarioActivo, 'escenario', $event)">{{ escenarios[escenarioActivo].escenario }}</td></tr>
            <tr><th>Precondiciones</th><td contenteditable="true" (input)="actualizarCampo(escenarioActivo, 'precondiciones', $event)">{{ escenarios[escenarioActivo].precondiciones }}</td></tr>
            <tr><th>Paso a Paso</th><td contenteditable="true" (input)="actualizarCampo(escenarioActivo, 'pasos', $event)">{{ escenarios[escenarioActivo].pasos }}</td></tr>
            <tr><th>Resultado Esperado</th><td contenteditable="true" (input)="actualizarCampo(escenarioActivo, 'resultadoEsperado', $event)">{{ escenarios[escenarioActivo].resultadoEsperado }}</td></tr>
          </tbody>
        </table>

        <div class="evidencias-section">
          <h3>Evidencias para Caso #{{ escenarioActivo + 1 }}</h3>
          <div class="evidencias-actions">
            <button class="btn btn-secondary" (click)="triggerFileInput(escenarioActivo)">Subir Evidencias</button>
            <input type="file" #fileInput style="display: none;" (change)="subirEvidencias($event, escenarioActivo)" multiple accept="image/*">
            <button class="btn btn-secondary" (click)="pegarEvidencia(escenarioActivo)">Pegar Evidencia</button>
            <button class="btn btn-danger" (click)="limpiarEvidencias(escenarioActivo)">Limpiar Evidencias</button>
          </div>
          <div class="evidencias-grid">
            <div *ngFor="let evidencia of escenarios[escenarioActivo].evidencias; let j = index" class="evidencia-block">
              <span class="delete-evidencia" (click)="eliminarEvidencia(escenarioActivo, j)">X</span>
              <img [src]="evidencia.src" alt="{{ evidencia.nombre }}">
              <input type="text" [(ngModel)]="evidencia.nombre" placeholder="Nombre de evidencia">
            </div>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="escenarios.length === 0">
      <p>No hay escenarios. Haz clic en "Agregar Escenario" para comenzar.</p>
    </div>
  </div>
</body>
</html>